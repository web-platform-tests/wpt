
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>testdriver.js Automation &#8212; web-platform-tests  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Testdriver extension tutorial" href="testdriver-extension-tutorial.html" />
    <link rel="prev" title="Submitting Tests" href="submission-process.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="testdriver-js-automation">
<h1>testdriver.js Automation<a class="headerlink" href="#testdriver-js-automation" title="Permalink to this headline">¶</a></h1>
<p>testdriver.js provides a means to automate tests that cannot be
written purely using web platform APIs. Outside of automation
contexts, it allows human operators to provide expected input
manually (for operations which may be described in simple terms).</p>
<p>It is currently supported only for <a class="reference internal" href="testharness.html"><span class="doc">testharness.js</span></a>
tests.</p>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>testdriver.js exposes its API through the <code class="docutils literal notranslate"><span class="pre">test_driver</span></code> variable in
the global scope.</p>
<p>NB: presently, testdriver.js only works in the top-level test browsing
context (and not therefore in any frame or window opened from it).</p>
<div class="section" id="actions">
<h3>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">new</span> <span class="n">test_driver</span><span class="o">.</span><span class="n">Actions</span><span class="p">()</span>
   <span class="o">.</span><span class="n">action1</span><span class="p">()</span>
   <span class="o">.</span><span class="n">action2</span><span class="p">();</span>
<span class="n">actions</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
<p>Test authors are encouraged to use the builder API to generate the sequence of actions. The builder
API can be accessed via the <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">test_driver.Actions()</span></code> object, and actions are defined in <a class="reference external" href="https://github.com/web-platform-tests/wpt/blob/master/resources/testdriver-actions.js">testdriver-actions.js</a></p>
<p>The <code class="docutils literal notranslate"><span class="pre">actions.send()</span></code> function causes the sequence of actions to be sent to the browser. It is based on the <a class="reference external" href="https://w3c.github.io/webdriver/#actions">WebDriver API</a>.
The action can be a keyboard action, a pointer action or a pause. It returns a promise that
resolves after the actions have been sent, or rejects if an error was thrown.</p>
<p>Example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">text_box</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">actions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">test_driver</span><span class="p">.</span><span class="nx">Actions</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">pointerMove</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="nx">origin</span><span class="o">:</span> <span class="nx">text_box</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">pointerDown</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">pointerUp</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">addTick</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">keyDown</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">keyUp</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">);</span>

<span class="nx">actions</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></div>
</div>
<p>Calling into <code class="docutils literal notranslate"><span class="pre">send()</span></code> is going to dispatch the action sequence (via <code class="docutils literal notranslate"><span class="pre">test_driver.action_sequence</span></code>) and also returns a promise which should be handled however is appropriate in the test. The other functions in the <code class="docutils literal notranslate"><span class="pre">Actions()</span></code> object are going to modify the state of the object by adding a new action in the sequence and returning the same object. So the functions can be easily chained, as shown in the example above. Here is a list of helper functions in the <code class="docutils literal notranslate"><span class="pre">Actions</span></code> class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pointerDown</span><span class="p">:</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">pointerDown</span> <span class="n">event</span> <span class="k">for</span> <span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">pointer</span> <span class="n">source</span>
<span class="n">pointerUp</span><span class="p">:</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">pointerUp</span> <span class="n">event</span> <span class="k">for</span> <span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">pointer</span> <span class="n">source</span>
<span class="n">pointerMove</span><span class="p">:</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">move</span> <span class="n">event</span> <span class="k">for</span> <span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">pointer</span> <span class="n">source</span>
<span class="n">keyDown</span><span class="p">:</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">keyDown</span> <span class="n">event</span> <span class="k">for</span> <span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">key</span> <span class="n">source</span>
<span class="n">keyUp</span><span class="p">:</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">keyUp</span> <span class="n">event</span> <span class="k">for</span> <span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">key</span> <span class="n">source</span>
<span class="n">pause</span><span class="p">:</span> <span class="n">Add</span> <span class="n">a</span> <span class="n">pause</span> <span class="n">to</span> <span class="n">the</span> <span class="n">current</span> <span class="n">tick</span>
<span class="n">addTick</span><span class="p">:</span> <span class="n">Insert</span> <span class="n">a</span> <span class="n">new</span> <span class="n">actions</span> <span class="n">tick</span>
<span class="n">setPointer</span><span class="p">:</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">pointer</span> <span class="n">source</span> <span class="p">(</span><span class="n">By</span> <span class="n">detault</span> <span class="n">the</span> <span class="n">pointerType</span> <span class="ow">is</span> <span class="n">mouse</span><span class="p">)</span>
<span class="n">addPointer</span><span class="p">:</span> <span class="n">Add</span> <span class="n">a</span> <span class="n">new</span> <span class="n">pointer</span> <span class="nb">input</span> <span class="n">source</span> <span class="k">with</span> <span class="n">the</span> <span class="n">given</span> <span class="n">name</span>
<span class="n">setKeyboard</span><span class="p">:</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">current</span> <span class="n">default</span> <span class="n">key</span> <span class="n">source</span>
<span class="n">addKeyboard</span><span class="p">:</span> <span class="n">Add</span> <span class="n">a</span> <span class="n">new</span> <span class="n">key</span> <span class="nb">input</span> <span class="n">source</span> <span class="k">with</span> <span class="n">the</span> <span class="n">given</span> <span class="n">name</span>
</pre></div>
</div>
</div>
<div class="section" id="bless">
<h3>bless<a class="headerlink" href="#bless" title="Permalink to this headline">¶</a></h3>
<p>Usage: <code class="docutils literal notranslate"><span class="pre">test_driver.bless(intent,</span> <span class="pre">action)</span></code></p>
<ul class="simple">
<li><em>intent</em>: a string describing the motivation for this invocation</li>
<li><em>action</em>: an optional function</li>
</ul>
<p>This function simulates <a class="reference external" href="https://html.spec.whatwg.org/multipage/interaction.html#activation">activation</a>, allowing tests to
perform privileged operations that require user interaction. For
example, sandboxed iframes with
<code class="docutils literal notranslate"><span class="pre">allow-top-navigation-by-user-activation</span></code> may only navigate their
parent’s browsing context under these circumstances. The <em>intent</em>
string is presented to human operators when the test is not run in
automation.</p>
<p>This method returns a promise which is resolved with the result of
invoking the <em>action</em> function. If no such function is provided, the
promise is resolved with the value <code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
<p>Example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">mediaElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">);</span>

<span class="nx">test_driver</span><span class="p">.</span><span class="nx">bless</span><span class="p">(</span><span class="s1">&#39;initiate media playback&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">mediaElement</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="click">
<h3>click<a class="headerlink" href="#click" title="Permalink to this headline">¶</a></h3>
<p>Usage: <code class="docutils literal notranslate"><span class="pre">test_driver.click(element)</span></code></p>
<ul class="simple">
<li><em>element</em>: a DOM Element object</li>
</ul>
<p>This function causes a click to occur on the target element (an
<code class="docutils literal notranslate"><span class="pre">Element</span></code> object), potentially scrolling the document to make it
possible to click it. It returns a promise that resolves after the
click has occurred or rejects if the element cannot be clicked (for
example, it is obscured by an element on top of it).</p>
<p>Note that if the element to be clicked does not have a unique ID, the
document must not have any DOM mutations made between the function
being called and the promise settling.</p>
</div>
<div class="section" id="send-keys">
<h3>send_keys<a class="headerlink" href="#send-keys" title="Permalink to this headline">¶</a></h3>
<p>Usage: <code class="docutils literal notranslate"><span class="pre">test_driver.send_keys(element,</span> <span class="pre">keys)</span></code></p>
<ul class="simple">
<li><em>element</em>: a DOM Element object</li>
<li><em>keys</em>: string to send to the element</li>
</ul>
<p>This function causes the string <em>keys</em> to be sent to the target
element (an <code class="docutils literal notranslate"><span class="pre">Element</span></code> object), potentially scrolling the document to
make it possible to send keys. It returns a promise that resolves
after the keys have been sent, or rejects if the keys cannot be sent
to the element.</p>
<p>Note that if the element that the keys need to be sent to does not have
a unique ID, the document must not have any DOM mutations made
between the function being called and the promise settling.</p>
<p>To send special keys, one must send the respective key’s codepoint. Since this uses the WebDriver protocol, you can find a <a class="reference external" href="https://w3c.github.io/webdriver/webdriver-spec.html#keyboard-actions">list for code points to special keys in the spec</a>.
For example, to send the tab key you would send “\uE004”.</p>
</div>
<div class="section" id="set-permission">
<h3>set_permission<a class="headerlink" href="#set-permission" title="Permalink to this headline">¶</a></h3>
<p>Usage: <code class="docutils literal notranslate"><span class="pre">test_driver.set_permission(descriptor,</span> <span class="pre">state,</span> <span class="pre">one_realm)</span></code></p>
<ul class="simple">
<li><em>descriptor</em>: a
<a class="reference external" href="https://w3c.github.io/permissions/#dictdef-permissiondescriptor">PermissionDescriptor</a>
or derived object</li>
<li><em>state</em>: a
<a class="reference external" href="https://w3c.github.io/permissions/#enumdef-permissionstate">PermissionState</a>
value</li>
<li><em>one_realm</em>: a boolean that indicates whether the permission settings
apply to only one realm</li>
</ul>
<p>This function causes permission requests and queries for the status of a
certain permission type (e.g. “push”, or “background-fetch”) to always
return <em>state</em>. It returns a promise that resolves after the permission has
been set to be overridden with <em>state</em>.</p>
<p>Example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">test_driver</span><span class="p">.</span><span class="nx">set_permission</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;background-fetch&quot;</span> <span class="p">},</span> <span class="s2">&quot;denied&quot;</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">test_driver</span><span class="p">.</span><span class="nx">set_permission</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;push&quot;</span><span class="p">,</span> <span class="nx">userVisibleOnly</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="s2">&quot;granted&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">web-platform-tests</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../test-suite-design.html">Test Suite Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro-video-transcript.html">“Introduction to WPT” video transcript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running-tests/index.html">Running Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Writing Tests</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="general-guidelines.html">General Test Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="ahem.html">The Ahem Font</a></li>
<li class="toctree-l2"><a class="reference internal" href="assumptions.html">Test Assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="css-metadata.html">CSS Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="css-user-styles.html">CSS User Stylesheets</a></li>
<li class="toctree-l2"><a class="reference internal" href="file-names.html">File Name Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="h2tests.html">Writing H2 Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="lint-tool.html">Lint Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="making-a-testing-plan.html">Making a Testing Plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="manual.html">Manual Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="reftest-tutorial.html">Writing a reftest</a></li>
<li class="toctree-l2"><a class="reference internal" href="reftests.html">Reftests</a></li>
<li class="toctree-l2"><a class="reference internal" href="rendering.html">Rendering Test Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-features.html">Server Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="submission-process.html">Submitting Tests</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">testdriver.js Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="testdriver-extension-tutorial.html">Testdriver extension tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="testharness.html">testharness.js Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="testharness-tutorial.html">testharness.js tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">Command-line utility scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="visual.html">Visual Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="wdspec.html">wdspec tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="test-templates.html">Test Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="github-intro.html">Introduction to GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#test-type">Test Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#submitting-tests">Submitting Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reviewing-tests/index.html">Reviewing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Project Administration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Writing Tests</a><ul>
      <li>Previous: <a href="submission-process.html" title="previous chapter">Submitting Tests</a></li>
      <li>Next: <a href="testdriver-extension-tutorial.html" title="next chapter">Testdriver extension tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, wpt contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/writing-tests/testdriver.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>