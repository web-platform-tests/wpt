<!DOCTYPE html>

  <meta charset="UTF-8">

  <title>CSS Values Test: serialization of computed value of background-size: calc(67% - 50% + 4em)</title>

  <!--
  "
  Where percentages are not resolved at computed-value time,
  they are not resolved in math functions, e.g.
  calc(100% - 100% + 1em) resolves to calc(1em + 0%), not to
  1em. If there are special rules for computing percentages
  in a value (e.g. the height property), they apply whenever
  a math function contains percentages.
  "
  https://www.w3.org/TR/css-values-4/#calc-serialize
  -->

  <link rel="author" title="GÃ©rard Talbot" href="http://www.gtalbot.org/BrowserBugsSection/css21testsuite/">
  <link rel="help" href="https://www.w3.org/TR/css-values-3/#calc-computed-value">

  <meta name="flags" content="">
  <meta content="This test verifies that a term with a percentage unit that can not be resolved at computed-value time will require a calc() wrapper. A term with an em value, on the other hand, can be resolved at computed-value time and therefore must be absolutized to 'px'." name="assert">

  <script src="/resources/testharness.js"></script>

  <script src="/resources/testharnessreport.js"></script>

  <style>
  html, body
    {
      height: 100%;
      font-size: 16px;
      margin: 0px 8px;
    }

  div#target
    {
      background-color: yellow;
      background-image: url("support/cat.png");
      background-position: top center;
      background-repeat: no-repeat;
      height: 140px;
    }
  </style>

  <div id="target"></div>

  <script>
  function startTesting()
  {

  var targetElement = document.getElementById("target");

    function verifyComputedStyle(property_name, specified_value, expected_value, description)
    {

    test(function()
      {

      targetElement.style.setProperty(property_name, specified_value);

      assert_equals(getComputedStyle(targetElement)[property_name], expected_value);

      }, description);
    }

 /* verifyComputedStyle(property_name, specified_value, expected_value, description) */

    verifyComputedStyle("background-size", "calc(67% - 50% + 4em)", "calc(17% + 64px) auto", "testing background-size: calc(67% - 50% + 4em)");

    /*
    "Where percentages are not resolved at computed-value time,
    they are not resolved in math functions (...)"
    https://www.w3.org/TR/css-values-4/#calc-serialize

    Therefore here, the percentage is preserved and
    a calc() wrapper must be used. The 4em term
    should be resolved though.
    */

  }

  startTesting();

  </script>
