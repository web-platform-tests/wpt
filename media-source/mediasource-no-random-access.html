<!DOCTYPE html>
<!-- Copyright Â© 2016 Chromium authors and World Wide Web Consortium, (Massachusetts Institute of Technology, ERCIM, Keio University, Beihang). -->
<html>
    <head>
        <title>Open GOP test cases.</title>
        <script src="/resources/testharness.js"></script>
        <script src="/resources/testharnessreport.js"></script>
        <script src="mediasource-util.js"></script>
    </head>
    <body>
        <div id="log"></div>
        <script>

var subType = MediaSourceUtil.getSubType(MediaSourceUtil.VIDEO_ONLY_TYPE);
if (subType == 'mp4') {
  // TODO: Modify mp4 to not start with a keyframe, to also test that the
  // browser skips the invalid initial frames.

  var manifestFilenameVideo = "mp4/test-v-no-keyframe-segment-manifest.json";

  mediasource_test(function(test, mediaElement, mediaSource) {
    mediaElement.addEventListener("error", test.unreached_func("Unexpected event 'error'"));
    MediaSourceUtil.fetchManifestAndData(test, manifestFilenameVideo, function(typeVideo, dataVideo)
    {
        var sourceBufferVideo = mediaSource.addSourceBuffer(typeVideo);

        test.expectEvent(sourceBufferVideo, "updateend");
        test.expectEvent(mediaElement, "playing");
        sourceBufferVideo.appendBuffer(dataVideo);
        mediaElement.play();
        test.waitForExpectedEvents(function() {
            test.done();
        });
    });
  }, "Test support for mp4 segments that do not start with a keyframe.");
}
// TODO: webm analog for test.

        </script>
    </body>
</html>
