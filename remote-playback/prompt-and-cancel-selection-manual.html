<!DOCTYPE html>
<html>
  <title>
    Test that promise is rejected when user cancels device selection.
  </title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
  <script src="/common/media.js"></script>
  <body>
    <p>
      Click the button below to prompt for a remote playback device and cancel
      the selection of a device!
    </p>
    <button id="prompt-button">Pick device</button>
  </body>
  <script>
    async_test((t) => {
      var v = document.createElement("video");
      v.src = getVideoURI("/media/movie_5");

      function callback(available) {
        async_test((t) => {
          v.remote
            .prompt()
            .then(t.unreached_func())
            .catch(
              t.step_func_done((error) =>
                assert_equals(error.name, "NotAllowedError")
              )
            );
        }, "Test that promise is rejected with 'NotAllowedError'.");
      }

      var button = document.getElementById("prompt-button");
      button.onclick = function () {
        v.remote.watchAvailability(t.step_func_done(callback)).then(
          t.step_func(() => {}),
          t.unreached_func()
        );
      };
    }, "Test that promise is rejected when user cancels device selection.");
  </script>
</html>
