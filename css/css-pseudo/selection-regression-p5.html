<!doctype html>
<meta charset="utf-8">
<title>CSS Pseudo-Elements Test: regression tests for ::selection backgrounds and decorations</title>
<link rel="help" href="https://drafts.csswg.org/css-pseudo-4/#highlight-painting">
<link rel="help" href="https://drafts.csswg.org/css-text-decor-4/#painting">
<link rel="help" href="https://www.w3.org/TR/CSS22/zindex.html#painting-order">
<link rel="match" href="selection-decoration-p5-ref1.html">
<link rel="match" href="selection-decoration-p5-ref2.html">
<meta name="assert" value="::selection background always paints over unselected parts when selecting text">
<script src="support/selections.js"></script>
<link rel="stylesheet" href="support/highlights.css">
<style>
    /*
        This test verifies that when selecting text, the ::selection
        background always paints over unselected parts.

        Chromium fails this test before <https://crrev.com/850580>.
    */
    @font-face {
        font-family: CSSTest;
        src: url(/fonts/CSSTest/csstest-basic-italic.ttf);
    }
    main {
        font: 80px/1 CSSTest;
        margin: 0.5em;
        width: min-content;
    }
    main > span {
        background: black;
        color: orange;
    }
    main > span::selection {
        /*
            Safari on macOS: opaque selection backgrounds are made
            translucent in the used value, so we need to choose a
            background color with known but non-opaque alpha.
        */
        background: #0000FFC0;
        color: transparent;
    }
</style>
<p>Test passes if the blue rectangle below contains no proper orange, only orange dimmed by blue.
<main class="highlight_reftest"><span>ii∫∫∫</span></main>
<script>
    const target = document.querySelector("main > span");
    selectRangeWith(range => {
        range.selectNodeContents(target);
        range.setStart(target.childNodes[0], 0);
        range.setEnd(target.childNodes[0], 3);
    });
</script>
