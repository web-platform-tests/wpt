<!DOCTYPE html>
<head>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>

  <!-- Helper Functions for getting ResourceID -->
  <script src="../resources/get-resourceID.js"></script>
  <!-- Responsible for testing Initiator Attribute -->
  <script src="../resources/test-initiator.js"></script>

  <!-- Empty Blocking Script -->
  <script src="../resources/empty.js?blocking"></script>
  <!-- Empty Preloaded Script -->
  <link rel="preload" href="../resources/empty.js?preload" as="script" />
  <!--  Loading arbitrary Empty Blocking Async Script -->
  <script async src="../resources/empty.js?async"></script>
  <!-- Loading arbitrary Empty Deferred Script -->
  <script defer src="../resources/empty.js?deferred"></script>
  <!-- Loading arbitrary Empty Module Script -->
  <script type="module" src="../resources/empty.js?module"></script>
  <!-- Empty Stylesheet -->
  <link rel="stylesheet" href="../resources/empty_style.css?link" />
  <!-- Inline Styles -->
  <style>
    body {
      background-image: url("/images/blue.png?inline-style");
      font-family: remoteFont, sans-serif;
    }
    @font-face {
      font-family: remoteFont;
      src: url("/fonts/Ahem.ttf");
    }
  </style>
</head>
<body>
  <!-- Loading an arbitrary Image using <img> tag -->
  <img
    src="/images/blue.png?using-Img-tag"
    alt="Sample Image for testing initiator Attribute"
  />

  <iframe src="../resources/green.html"></iframe>

  <script>
      // Insert arbitrary resources with doc.write
      document.write('<link rel="stylesheet" href="../resources/empty_style.css?inline-script-doc-write">');
    document.write('<img src="/images/blue.png?inline-script-doc-write">');
      document.write('<script src="../resources/empty.js?doc-write"><\/script>');

    // Load arbitrary stylesheet with inline script
    const link = document.createElement("link");
    link.rel = "stylesheet";
    link.href = "../resources/empty_style.css?inline-script";
    document.head.appendChild(link);

    // Load arbitrary image with inline script
    const img = document.createElement("img");
    img.src = "/images/blue.png?inline-script";
    document.body.appendChild(img);

    // Testing Initiator of all the resources loaded
    promise_test(async (t) => {
      const DocumentResourceID = await getDocumentResourceID();
      const parser_attributed_resources = [
        "empty.js?blocking",
        "empty.js?preload",
        "empty.js?async",
        "empty.js?module",
        "empty.js?deferred",
        "empty_style.css?link",
        "blue.png?inline-style",
        "Ahem.ttf",
        // The following Cases are yet not covered by Parser Preloading and
        // thus, will be dealt in subsequent CLs.
        // "green.html",
        // "empty_style.css?inline-script",
        // "blue.png?inline-script",
        // "blue.png?using-Img-tag",
      ];
      for (const resource of parser_attributed_resources) {
        await testResourceInitiator(resource, DocumentResourceID);
      }
      const not_parser_attributed_resources = [
        // The following cases should not be attributed to document as they were added by doc.write so currently we should report unkoown intiator( value =0).
        // These cases will be picked up in subsequent CL's to report correct Initiator.
        "empty.js?doc-write",
        "empty_style.css?inline-script-doc-write",
        "blue.png?inline-script-doc-write"
      ];
      const unknownInitiator = 0;
      for (const resource of not_parser_attributed_resources) {
        await testResourceInitiator(resource, unknownInitiator);
      }
    }, "Ensure initiator Attribute matches with Document ResourceID");
  </script>
</body>
