<!DOCTYPE html>
<head>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
</head>
<body>
<iframe src="support/frame-with-csp.sub.html?csp=script-src%20%27unsafe-inline%27"></iframe>
<script>
  frames[0].addEventListener('load', () => {

    promise_test(t => { return new Promise(resolve => {
      window.addEventListener("message", t.step_func(function(e) {
        if (e.data == "executed") {
          resolve();
        }
      }));

      window.addEventListener('securitypolicyviolation',
        t.unreached_func("Should not have raised a violation event"));

      frames[0].location.href = "javascript:parent.postMessage('executed', '*')";
    })}, "Should have executed the javascript url");

  });
</script>
</body>
