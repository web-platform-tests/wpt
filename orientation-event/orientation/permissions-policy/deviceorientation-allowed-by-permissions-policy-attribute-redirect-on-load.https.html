<!DOCTYPE html>
<body>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
  <script src="/resources/testdriver.js"></script>
  <script src="/resources/testdriver-vendor.js"></script>
  <script src="/permissions-policy/resources/orientation-event.js"></script>
  <script src="/permissions-policy/resources/permissions-policy.js"></script>
  <script src="/common/get-host-info.sub.js"></script>
  <script src="../../resources/orientation-event-helpers.js"></script>
  <script>
    "use strict";

    const relative_path =
      "/permissions-policy/resources/permissions-policy-orientation-event.sub.html?eventName=deviceorientation";
    const base_src = "/permissions-policy/resources/redirect-on-load.html#";
    const same_origin_src = base_src + relative_path;
    const cross_origin_src =
      base_src + get_host_info().HTTPS_REMOTE_ORIGIN + relative_path;

    promise_test(async (t) => {
      const helper = new SensorTestHelper(t, "deviceorientation");
      await helper.grantSensorsPermissions();
      await helper.initializeSensors();

      const orientationData = generateOrientationData(1, 2, 3, false);
      await helper.setData(orientationData);

      return test_feature_availability_with_post_message_result(
        t,
        same_origin_src,
        JSON.stringify(orientationData),
        "accelerometer; gyroscope"
      );
    }, `"allow" attribute allows same-origin navigation in an iframe`);

    promise_test(async (t) => {
      const helper = new SensorTestHelper(t, "deviceorientation");
      await helper.grantSensorsPermissions();
      await helper.initializeSensors();

      const orientationData = generateOrientationData(1, 2, 3, false);
      await helper.setData(orientationData);

      return test_feature_availability_with_post_message_result(
        t,
        cross_origin_src,
        "NO-EVENT",
        "accelerometer; gyroscope"
      );
    }, `"allow" disallows cross-origin navigation in an iframe`);
  </script>
</body>
