<!doctype html>
<meta charset=utf-8>
<title>WindowClient ancestorOrigins helper</title>
<script>
(async function() {
  const registration = await navigator.serviceWorker.register("ancestorOrigins.js", { scope: './' });
  let activeWorker = registration.installing;
  if (activeWorker) {
    await new Promise(resolve => {
      activeWorker.addEventListener('statechange', () => {
        if (activeWorker.state === "activated") {
          resolve();
        }
      });
    });
  } else {
    activeWorker = registration.active;
  }

  async function gimmeAncestorOrigins() {
    activeWorker.postMessage("gimme!");
    const msgEvt = await new Promise(resolve => {
      navigator.serviceWorker.addEventListener("message", resolve, { once: true });
    });
    return msgEvt.data.ancestorOrigins;
  }

  const swAO = await gimmeAncestorOrigins();
  const locationAO = Array.from(location.ancestorOrigins);

  parent.postMessage({id: window.name, swAO, locationAO}, '*');
})();
</script>
