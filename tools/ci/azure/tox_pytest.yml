parameters:
  directory: ''
  toxenv: 'ALL'
  
steps:
- script: |
    python --version
    python -m pip --version
    python -m pip --debug --verbose --verbose --disable-pip-version-check install --upgrade -r tools/ci/requirements_tox.txt
  displayName: 'Install Python packages'

- script: |
    set -eux -o pipefail
    python -m tox -c ${{ parameters.directory }} -e ${{ parameters.toxenv }} -- --junitxml=results.xml
  displayName: 'Run tests'

- task: PublishTestResults@2
  inputs:
    testResultsFiles: '${{ parameters.directory }}/results.xml'
    testRunTitle: '${{ parameters.directory }}'
  displayName: 'Publish results'
  condition: succeededOrFailed()
