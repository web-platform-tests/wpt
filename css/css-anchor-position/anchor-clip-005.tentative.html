<!DOCTYPE html>
<html class="reftest-wait">
<title>Tests the 'anchor-clip' property with layout updates</title>
<link rel="help" href="https://drafts.csswg.org/css-anchor-position-1/#anchor-clip">
<link rel="match" href="anchor-clip-005-ref.html">
<link rel="author" href="mailto:xiaochengh@chromium.org">

<style>
.cb {
  position: relative;
  margin-block: 25px;
}

.scroller {
  overflow-x: scroll;
  width: 200px;
  height: 125px;
}

.anchor {
  width: 100px;
  height: 100px;
  margin-right: 300px;
  anchor-name: --a;
  background: orange;
}

.target {
  position: absolute;
  width: 100px;
  height: 100px;
  background: lime;
  anchor-default: --a;
  top: anchor(top);
  left: calc(anchor(right) + 100px);
}

/* Moves target into scroller */
.target.after {
  left: anchor(right);
}

/* Enlarges scroller to contain target */
.scroller.after {
  width: 300px;
}

/* Removes clipping to reveal target */
.scroller.remove-clip {
  overflow: visible;
}

.no-clip {
  anchor-clip: none;
}
</style>

<div class="cb">
  <div class="scroller">
    <div class="anchor"></div>
  </div>
  <div class="target"></div>
</div>

<div class="cb">
  <div class="scroller">
    <div class="anchor"></div>
  </div>
  <div class="target"></div>
</div>

<div class="cb">
  <div class="scroller">
    <div class="anchor"></div>
  </div>
  <div class="target"></div>
</div>

<script type="module">
function raf() { return new Promise(resolve => requestAnimationFrame(resolve)); }

await raf();
await raf();

document.querySelectorAll('.target')[0].classList.add('after');
document.querySelectorAll('.scroller')[1].classList.add('after');
document.querySelectorAll('.scroller')[2].classList.add('remove-clip');

document.documentElement.classList.remove('reftest-wait');
</script>

</html>
