<!doctype html>
<meta charset="utf-8">
<title>CSS Test: punctuation and intervening whitespace codepoints that are included in ::first-letter</title>
<link rel="author" title="Johannes Odland" href="mailto:johannes.odland@gmail.com">
<link rel="help" href="https://drafts.csswg.org/css-pseudo-4/#first-letter-pseudo">
<link rel="stylesheet" type="text/css" href="/fonts/ahem.css"/>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<style>
    #target div {
        position: absolute;
        top: 0;
        left: 0;
        font-family: Ahem;
        font-size: 16px !important;
        opacity: 0;
    }

    #target div::first-letter {
        color: green;
        font-size: 0;
    }
</style>
<script>
    /* Punctuation in (Pc), (Pd), (Ps), (Pe), (Pi), (Pf), (Po) */
    const Pc = ['_', 'â€¿', 'â€', 'â”', 'ï¸³', 'ï¸´', 'ï¹', 'ï¹Ž', 'ï¹', 'ï¼¿'];
    const Pd = ['-', 'ÖŠ', 'Ö¾', 'á€', 'á †', 'â€', 'â€‘', 'â€’', 'â€“', 'â€”', 'â€•', 'â¸—', 'â¸š', 'â¸º', 'â¸»', 'â¹€', 'â¹', 'ã€œ', 'ã€°', 'ã‚ ', 'ï¸±', 'ï¸²', 'ï¹˜', 'ï¹£', 'ï¼', 'ðº­'];
    const Ps = ['(', '[', '{', 'à¼º', 'à¼¼', 'áš›', 'â€š', 'â€ž', 'â…', 'â½', 'â‚', 'âŒˆ', 'âŒŠ', 'âŒ©', 'â¨', 'âª', 'â¬', 'â®', 'â°', 'â²',
        'â´', 'âŸ…', 'âŸ¦', 'âŸ¨', 'âŸª', 'âŸ¬', 'âŸ®', 'â¦ƒ', 'â¦…', 'â¦‡', 'â¦‰', 'â¦‹', 'â¦‘', 'â¦“', 'â¦•', 'â¦—', 'â§¼', 'â¦', 'â¦', 'â§˜', 'â§š', 'â¸¢', 'â¸¤',
        'â¸¦', 'â¸¨', 'â¹•', 'â¹—', 'â¹‚', 'â¹™', 'â¹›', 'ã€ˆ', 'ã€Š', 'ã€Œ', 'ã€Ž', 'ã€', 'ã€”', 'ã€–', 'ã€˜', 'ã€š', 'ã€', 'ï´¿', 'ï¸—', 'ï¸µ',
        'ï¸·', 'ï¸¹', 'ï¸»', 'ï¸½', 'ï¸¿', 'ï¹', 'ï¹ƒ', 'ï¹‡', 'ï¹™', 'ï¹›', 'ï¹', 'ï¼ˆ', 'ï¼»', 'ï½›', 'ï½Ÿ', 'ï½¢'];
    const Pe = [')', ']', '}', 'à¼»', 'à¼½', 'ášœ', 'â†', 'â¾', 'â‚Ž', 'âŒ‰', 'âŒ‹', 'âŒª', 'â©', 'â«', 'â­', 'â¯', 'â±', 'â³',
        'âµ', 'âŸ†', 'âŸ§', 'âŸ©', 'âŸ«', 'âŸ­', 'âŸ¯', 'â¦„', 'â¦†', 'â¦ˆ', 'â¦Š', 'â¦Œ', 'â¦’', 'â¦”', 'â¦–', 'â¦˜', 'â§½', 'â¦Ž', 'â¦', 'â§™', 'â§›', 'â¸£', 'â¸¥',
        'â¸§', 'â¸©', 'â¹–', 'â¹˜', 'â¹š', 'â¹œ', 'ã€‰', 'ã€‹', 'ã€', 'ã€', 'ã€‘', 'ã€•', 'ã€—', 'ã€™', 'ã€›', 'ã€ž', 'ã€Ÿ', 'ï´¾', 'ï¸˜', 'ï¸¶',
        'ï¸¸', 'ï¸º', 'ï¸¼', 'ï¸¾', 'ï¹€', 'ï¹‚', 'ï¹„', 'ï¹ˆ', 'ï¹š', 'ï¹œ', 'ï¹ž', 'ï¼‰', 'ï¼½', 'ï½', 'ï½ ', 'ï½£'];
    const Pi = ['Â«', 'â€˜', 'â€›', 'â€œ', 'â€Ÿ', 'â€¹', 'â¸‚', 'â¸„', 'â¸‰', 'â¸Œ', 'â¸œ', 'â¸ '];
    const Pf = ['Â»', 'â€™', 'â€', 'â€º', 'â¸ƒ', 'â¸…', 'â¸Š', 'â¸', 'â¸', 'â¸¡'];
    const Po = [
        // Basic Latin
        '!', '"', '#', '%', '&', '\'', '*', '\\',
        ',', '.', '/', ':', ';', '?', '@',
        // Latin 1 Supplement
        'Â¡', 'Â§', 'Â¶', 'Â·', 'Â¿',
        // Greek And Coptic
        'Í¾', 'Î‡',
        // Armenian
        'Õš', 'Õ›', 'Õœ', 'Õ', 'Õž', 'ÕŸ', 'Ö‰',
        // Hebrew
        '×€', '×ƒ', '×†', '×³', '×´',
        // Arabic
        'Ø‰', 'ØŠ', 'ØŒ', 'Ø', 'Ø›', 'Ø', 'Øž', 'ØŸ', 'Ùª', 'Ù«', 'Ù¬', 'Ù­', 'Û”',
        // Syriac
        'Ü€', 'Ü', 'Ü‚', 'Üƒ', 'Ü„', 'Ü…', 'Ü†', 'Ü‡', 'Üˆ', 'Ü‰', 'ÜŠ', 'Ü‹', 'ÜŒ', 'Ü',
        // NKo
        'ß·', 'ß¸', 'ß¹',
        // Samaritan
        'à °', 'à ±', 'à ²', 'à ³', 'à ´', 'à µ', 'à ¶', 'à ·', 'à ¸', 'à ¹', 'à º', 'à »', 'à ¼', 'à ½', 'à ¾',
        // Mandaic
        'à¡ž',
        // Devanagari
        'à¥¤', 'à¥¥', 'à¥°',
        // Bengali
        'à§½',
        // Gurmukhi
        'à©¶',
        // Gujarati
        'à«°',
        // Telugu
        'à±·',
        // Kannada
        'à²„',
        // Sinhala,
        'à·´',
        // Thai
        'à¹', 'à¹š', 'à¹›',
        // Tibetan
        'à¼„', 'à¼…', 'à¼†', 'à¼‡', 'à¿“', 'à¿”', 'à¼ˆ', 'à¼‰', 'à¼Š', 'à¼‹', 'à¼Œ', 'à¼', 'à¼Ž', 'à¼', 'à¼', 'à¼‘', 'à¼’', 'à¼”', 'à¾…', 'à¿', 'à¿‘', 'à¿’', 'à¿™', 'à¿š',
        // Myanmar
        'áŠ', 'á‹', 'áŒ', 'á', 'áŽ', 'á',
        // Georgian
        'áƒ»',
        // Ethiopic
        'á ', 'á¡', 'á¢', 'á£', 'á¤', 'á¥', 'á¦', 'á§', 'á¨',
        // Unified Canadian Aboriginal Syllabics
        'á™®',
        // Runic
        'á›«', 'á›¬', 'á›­',
        // Hanunoo
        'áœµ', 'áœ¶',
        // Khmer
        'áŸ”', 'áŸ•', 'áŸ–', 'áŸ˜', 'áŸ™', 'áŸš',
        // Mongolian
        'á €', 'á ', 'á ‚', 'á ƒ', 'á „', 'á …', 'á ‡', 'á ˆ', 'á ‰', 'á Š',
        // Limbu
        'á¥„', 'á¥…',
        // Buginese
        'á¨ž', 'á¨Ÿ',
        // Tai Tham
        'áª ', 'áª¡', 'áª¢', 'áª£', 'áª¤', 'áª¥', 'áª¦', 'áª¨', 'áª©', 'áªª', 'áª«', 'áª¬', 'áª­',
        // Balinese
        'á­š', 'á­›', 'á­œ', 'á­', 'á­ž', 'á­Ÿ', 'á­ ', 'á­½', 'á­¾',
        // Batak
        'á¯¼', 'á¯½', 'á¯¾', 'á¯¿',
        // Lepcha
        'á°»', 'á°¼', 'á°½', 'á°¾', 'á°¿',
        // Ol Chiki
        'á±¾', 'á±¿',
        // Sundanese Supplement
        'á³€', 'á³', 'á³‚', 'á³ƒ', 'á³„', 'á³…', 'á³†', 'á³‡',
        // Vedic Extensions
        'á³“',
        // General Punctuation
        'â€–', 'â€—', 'â€ ', 'â€¡', 'â€¢', 'â€£', 'â€¤', 'â€¥', 'â€¦', 'â€§', 'â€°', 'â€±', 'â€²', 'â€³', 'â€´', 'â€µ', 'â€¶', 'â€·', 'â€¸', 'â€»', 'â€½', 'â€¾',
        'â', 'â‚', 'âƒ', 'âŠ', 'â‹', 'âŒ', 'â', 'âŽ', 'â', 'â', 'â‘', 'â“', 'â•', 'â—', 'â€¼', 'â‡', 'âˆ', 'â‰', 'â–', 'â˜', 'â™', 'âš', 'â›',
        'âœ', 'â', 'âž',
        // Coptic
        'â³¹', 'â³º', 'â³»', 'â³¼', 'â³¾', 'â³¿',
        // Tifinagh
        'âµ°',
        // Supplemental Punctuation
        'â¸€', 'â¸', 'â¸†', 'â¸‡', 'â¸ˆ', 'â¸‹', 'â¸Ž', 'â¸', 'â¸', 'â¸‘', 'â¸’', 'â¸“', 'â¸”', 'â¸•', 'â¸–', 'â¸˜', 'â¸™', 'â¸›', 'â¸ž', 'â¸Ÿ', 'â¸ª', 'â¸«',
        'â¸¬', 'â¸­', 'â¸®', 'â¸°', 'â¸±', 'â¸³', 'â¸´', 'â¸¿', 'â¹Š', 'â¹‹', 'â¹Œ', 'â¹', 'â¹Ž', 'â¹', 'â¹’', 'â¹“', 'â¹”', 'â¸²', 'â¸µ', 'â¸¶', 'â¸·', 'â¸¸',
        'â¸¹', 'â¸¼', 'â¸½', 'â¸¾', 'â¹', 'â¹ƒ', 'â¹„', 'â¹…', 'â¹†', 'â¹‡', 'â¹ˆ', 'â¹‰',
        // CJK Symbols And Punctuation
        'ã€', 'ã€‚', 'ã€ƒ', 'ã€½',
        // Katakana
        'ãƒ»',
        // Lisu
        'ê“¾', 'ê“¿',
        // Vai
        'ê˜', 'ê˜Ž', 'ê˜',
        // Cyrillic Extended B
        'ê™³', 'ê™¾',
        // Bamum
        'ê›²', 'ê›³', 'ê›´', 'ê›µ', 'ê›¶', 'ê›·',
        // Phags Pa
        'ê¡´', 'ê¡µ', 'ê¡¶', 'ê¡·',
        // Saurashtra
        'ê£Ž', 'ê£',
        // Devanagari Extended
        'ê£¸', 'ê£¹', 'ê£º', 'ê£¼',
        // Kayah Li
        'ê¤®', 'ê¤¯',
        // Rejang
        'ê¥Ÿ',
        // Javanese
        'ê§', 'ê§‚', 'ê§ƒ', 'ê§„', 'ê§…', 'ê§†', 'ê§‡', 'ê§ˆ', 'ê§‰', 'ê§Š', 'ê§‹', 'ê§Œ', 'ê§', 'ê§ž', 'ê§Ÿ',
        // Cham
        'ê©œ', 'ê©', 'ê©ž', 'ê©Ÿ',
        // Tai Viet
        'ê«ž', 'ê«Ÿ',
        // Meetei Mayek Extensions, Meetei Mayek
        'ê«°', 'ê«±', 'ê¯«',
        // Vertical Forms
        'ï¸', 'ï¸‘', 'ï¸’', 'ï¸“', 'ï¸”', 'ï¸•', 'ï¸–', 'ï¸™',
        // CJK Compatibility Forms
        'ï¸°', 'ï¹…', 'ï¹†', 'ï¹‰', 'ï¹Š', 'ï¹‹', 'ï¹Œ',
        // Small Form Variants
        'ï¹', 'ï¹‘', 'ï¹’', 'ï¹”', 'ï¹•', 'ï¹–', 'ï¹—', 'ï¹Ÿ', 'ï¹ ', 'ï¹¡', 'ï¹¨', 'ï¹ª', 'ï¹«',
        // Halfwidth And Fullwidth Forms
        'ï¼', 'ï¼‚', 'ï¼ƒ', 'ï¼…', 'ï¼†', 'ï¼‡', 'ï¼Š', 'ï¼Œ', 'ï¼Ž', 'ï¼', 'ï¼š', 'ï¼›', 'ï¼Ÿ', 'ï¼ ', 'ï¼¼', 'ï½¡', 'ï½¤', 'ï½¥',
        // Aegean Numbers
        'ð„€', 'ð„', 'ð„‚',
        // Ugaritic
        'ðŽŸ',
        // Old Persian
        'ð',
        // Caucasian Albanian
        'ð•¯',
        // Imperial Aramaic
        'ð¡—',
        // Phoenician
        'ð¤Ÿ',
        // Lydian
        'ð¤¿',
        // Kharoshthi
        'ð©', 'ð©‘', 'ð©’', 'ð©“', 'ð©”', 'ð©•', 'ð©–', 'ð©—', 'ð©˜',
        // Old South Arabian
        'ð©¿',
        // Manichaean
        'ð«°', 'ð«±', 'ð«²', 'ð«³', 'ð«´', 'ð«µ', 'ð«¶',
        // Avestan
        'ð¬¹', 'ð¬º', 'ð¬»', 'ð¬¼', 'ð¬½', 'ð¬¾', 'ð¬¿',
        // Psalter Pahlavi
        'ð®™', 'ð®š', 'ð®›', 'ð®œ',
        // Sogdian
        'ð½•', 'ð½–', 'ð½—', 'ð½˜', 'ð½™',
        // Old Uyghur
        'ð¾†', 'ð¾‡', 'ð¾ˆ', 'ð¾‰',
        // Brahmi
        'ð‘‡', 'ð‘ˆ', 'ð‘‰', 'ð‘Š', 'ð‘‹', 'ð‘Œ', 'ð‘',
        // Kaithi
        'ð‘‚»', 'ð‘‚¼', 'ð‘‚¾', 'ð‘‚¿', 'ð‘ƒ€', 'ð‘ƒ',
        // Chakma
        'ð‘…€', 'ð‘…', 'ð‘…‚', 'ð‘…ƒ',
        // Mahajani
        'ð‘…´', 'ð‘…µ',
        // Sharada
        'ð‘‡…', 'ð‘‡†', 'ð‘‡‡', 'ð‘‡ˆ', 'ð‘‡', 'ð‘‡›', 'ð‘‡', 'ð‘‡ž', 'ð‘‡Ÿ',
        // Khojki
        'ð‘ˆ¸', 'ð‘ˆ¹', 'ð‘ˆº', 'ð‘ˆ»', 'ð‘ˆ¼', 'ð‘ˆ½',
        // Multani
        'ð‘Š©',
        // Newa
        'ð‘‘‹', 'ð‘‘Œ', 'ð‘‘', 'ð‘‘Ž', 'ð‘‘', 'ð‘‘š', 'ð‘‘›', 'ð‘‘',
        // Tirhuta
        'ð‘“†',
        // Siddham
        'ð‘—', 'ð‘—‚', 'ð‘—ƒ', 'ð‘—„', 'ð‘—…', 'ð‘—†', 'ð‘—‡', 'ð‘—ˆ', 'ð‘—‰', 'ð‘—Š', 'ð‘—‹', 'ð‘—Œ', 'ð‘—', 'ð‘—Ž', 'ð‘—', 'ð‘—', 'ð‘—‘', 'ð‘—’', 'ð‘—“', 'ð‘—”', 'ð‘—•', 'ð‘—–', 'ð‘——',
        // Modi
        'ð‘™', 'ð‘™‚', 'ð‘™ƒ',
        // Mongolian Supplement
        'ð‘™ ', 'ð‘™¡', 'ð‘™¢', 'ð‘™£', 'ð‘™¤', 'ð‘™¥', 'ð‘™¦', 'ð‘™§', 'ð‘™¨', 'ð‘™©', 'ð‘™ª', 'ð‘™«', 'ð‘™¬',
        // Takri
        'ð‘š¹',
        // Ahom
        'ð‘œ¼', 'ð‘œ½', 'ð‘œ¾',
        // Dogra
        'ð‘ »',
        // Dives Akuru
        'ð‘¥„', 'ð‘¥…', 'ð‘¥†',
        // Nandinagari
        'ð‘§¢',
        // Zanabazar Square
        'ð‘¨¿', 'ð‘©€', 'ð‘©…', 'ð‘©†', 'ð‘©', 'ð‘©‚', 'ð‘©ƒ', 'ð‘©„',
        // Soyombo
        'ð‘ªš', 'ð‘ª›', 'ð‘ªœ', 'ð‘ªž', 'ð‘ªŸ', 'ð‘ª ', 'ð‘ª¡', 'ð‘ª¢',
        // Devanagari Extended A
        'ð‘¬€', 'ð‘¬', 'ð‘¬‚', 'ð‘¬ƒ', 'ð‘¬„', 'ð‘¬…', 'ð‘¬†', 'ð‘¬‡', 'ð‘¬ˆ', 'ð‘¬‰',
        // Bhaiksuki
        'ð‘±', 'ð‘±‚', 'ð‘±ƒ', 'ð‘±„', 'ð‘±…',
        // Marchen
        'ð‘±°', 'ð‘±±',
        // Makasar
        'ð‘»·', 'ð‘»¸',
        // Kawi
        'ð‘½ƒ', 'ð‘½„', 'ð‘½…', 'ð‘½†', 'ð‘½‡', 'ð‘½ˆ', 'ð‘½‰', 'ð‘½Š', 'ð‘½‹', 'ð‘½Œ', 'ð‘½', 'ð‘½Ž', 'ð‘½',
        // Tamil Supplement
        'ð‘¿¿',
        // Cuneiform Numbers And Punctuation
        'ð’‘°', 'ð’‘±', 'ð’‘²', 'ð’‘³', 'ð’‘´',
        // Cypro Minoan
        'ð’¿±', 'ð’¿²',
        // Mro
        'ð–©®', 'ð–©¯',
        // Bassa Vah
        'ð–«µ',
        // Pahawh Hmong
        'ð–¬·', 'ð–¬¸', 'ð–¬¹', 'ð–¬º', 'ð–¬»', 'ð–­„',
        // Medefaidrin
        'ð–º—', 'ð–º˜', 'ð–º™', 'ð–ºš',
        // Ideographic Symbols And Punctuation
        'ð–¿¢',
        // Duployan
        'ð›²Ÿ',
        // Sutton SignWriting
        'ðª‡', 'ðªˆ', 'ðª‰', 'ðªŠ', 'ðª‹',
        // Adlam
        'ðž¥ž', 'ðž¥Ÿ'
    ];

    const Zs = [' ', 'Â ', 'áš€', 'â€€', 'â€', 'â€‚', 'â€ƒ', 'â€„', 'â€…', 'â€†', 'â€‡', 'â€ˆ', 'â€‰', 'â€Š', 'â€¯', 'âŸ', 'ã€€'];

    // Word-separator characters are typographic character units whose primary purpose and general usage is to separate
    // words. In Unicode this includes (but is not exhaustively defined as) the space (U+0020),
    // the no-break space (U+00A0), the Ethiopic word space (U+1361), the Aegean word separators (U+10100,U+10101),
    // the Ugaritic word divider (U+1039F), and the Phoenician word separator (U+1091F).
    const wordSeparators = [' ', 'Â ', 'á¡', 'ð„€', 'ð„', 'ðŽŸ', 'ð¤Ÿ'];

    function formatCodepoint(str) {
        return `\\u+${str.codePointAt(0).toString(16).padStart(4, '0')}`;
    }

    setup({explicit_done: true});

    async function runTest() {
        const target = document.querySelector("#target");
        let tests = [];

        function setupTest(testString, name) {
            const el = document.createElement('div');
            el.innerHTML = testString;
            target.appendChild(el);

            tests.push({el, name});
        }

        // All punctuationâ€”i.e, characters that belong to the Punctuation (P*) Unicode
        // general category [UAX44]â€”that precedes the first letter,
        for (const p of [Pc, Pd, Ps, Pe, Pi, Pf, Po].flat()) {
            setupTest(`${p}Test`, `Preceding punctuation ${p} (${formatCodepoint(p)}) should be included`)
        }

        const multiplePrecedingCharacters = Pc[0] + Pd[0] + Ps[0]
        setupTest(`${multiplePrecedingCharacters}Test`, `Multiple preceding punctuation characters ${multiplePrecedingCharacters} should be included`)

        // as well as any intervening typographic spaceâ€”characters belonging to the Zs
        // Unicode general category [UAX44] other than U+3000 IDEOGRAPHIC SPACE.
        for (const s of Zs.filter(char => char.codePointAt(0) !== 0x3000)) {
            setupTest(`"${s}Test`, `Intervening typographic space ${(formatCodepoint(s))} before the first-letter should be included`)
        }

        const multipleInterveningSpaces = Zs[5] + Zs[6] + Zs[7]
        setupTest(`"${multipleInterveningSpaces}Test`, `Multiple intervening typographic spaces before the first-letter should be included`)

        // Any punctuation other than opening punctuation and dashesâ€”i.e. characters that belong to the Punctuation (P*)
        // Unicode general category, excluding Open Punctuation (Ps) and Dash Punctuation (Pd)â€”that follows the first letter,
        for (const p of [Pc, Pe, Pi, Pf, Po].flat()) {
            setupTest(`T${p}est`, `Following punctuation ${p} (${formatCodepoint(p)}) should be included`)
        }

        const multipleFollowingCharacters = Pc[0] + Pe[0] + Pi[0]
        setupTest(`${multipleFollowingCharacters}Test`, `Multiple following punctuation characters ${multipleFollowingCharacters} should be included`)

        // as well as any intervening typographic spaceâ€”characters belonging to the Zs Unicode general category [UAX44]
        // other than U+3000 IDEOGRAPHIC SPACE or a word separator.
        for (const s of Zs.filter(char => char.codePointAt(0) !== 0x3000 && !wordSeparators.includes(char))) {
            setupTest(`T${s}"est`, `Intervening typographic space ${(formatCodepoint(s))} after the first-letter should be included`)
        }

        setupTest(`T${multipleInterveningSpaces}"est`, `Multiple intervening typographic spaces after the first-letter should be included`)

        await new Promise(r => requestAnimationFrame(() => requestAnimationFrame(r)));


        for (const {el, name} of tests) {
            // First-letter should include the T and surrounding punctuation and whitespace.
            // As the ::first-letter has font-size 0, the remaining size of the 'est' letters should be 3em = 48px
            test(() => assert_equals(el.offsetWidth, 48, 'width'), name);
        }

        target.innerHTML = ''
        tests = []
        done();
    }
</script>
<body onload="document.fonts.ready.then(() => { runTest(); })">
<div id="target">
    <div>Placeholder to ensure font has loaded</div>
</div>
</body>